<!DOCTYPE html>
<!DOCTYPE html>
<!DOCTYPE html>

<html lang="en">

<html lang="en">
<html lang="en">

<head>

  <meta charset="UTF-8">

  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>Dashboard - GST Invoice Generator</title>

  <head>

    <head>

      <link rel="icon" type="image/png" href="assets/images/logo-fav.png">

      <link rel="stylesheet" href="css/styles.css">
      <meta charset="UTF-8">
      <meta charset="UTF-8">

      <link rel="stylesheet" href="css/dashboard.css">

    </head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">



  <body>
    <title>Dashboard - GST Invoice Generator</title>
    <title>Dashboard - GST Invoice Generator</title>

    <nav class="navbar">

      <div class="nav-container">
        <link rel="icon" type="image/png" href="assets/images/logo-fav.png">
        <link rel="icon" type="image/png" href="assets/images/logo-fav.png">

        <h1>GST Invoice Generator</h1>

        <div class="nav-menu">
          <link rel="stylesheet" href="css/styles.css">
          <link rel="stylesheet" href="css/styles.css">

          <span id="user-info"></span>

          <button id="logout-btn">Logout</button>
          <link rel="stylesheet" href="css/dashboard.css">
          <link rel="stylesheet" href="css/dashboard.css">

        </div>

      </div>
</head>
</head>

</nav>



<!-- Loading Screen -->

<div id="loading-screen" class="loading-screen">

  <body>

    <body>

      <div class="loading-content">

        <div class="spinner"></div>
        <nav class="navbar">
          <nav class="navbar">

            <p>Loading Dashboard...</p>

      </div>
      <div class="nav-container">
        <div class="nav-container">

        </div>

        <h1>GST Invoice Generator</h1>
        <h1>GST Invoice Generator</h1>

        <!-- Main Dashboard -->

        <div id="dashboard-main" class="dashboard-container" style="display: none;">
          <div class="nav-menu">
            <div class="nav-menu">

              <div class="sidebar">

                <ul class="menu"> <span id="user-info"></span> <span id="user-info"></span>

                  <li><a href="#" class="menu-item active" data-section="saved-invoices">üìã Saved Invoices</a></li>

                  <li><a href="#" class="menu-item" data-section="profile-section">‚öôÔ∏è Profile Settings</a></li> <button
                    id="logout-btn">Logout</button> <button id="logout-btn">Logout</button>

                  <li><a href="index.html" class="menu-item">üìÑ Create New Invoice</a></li>

                </ul>
              </div>
            </div>

          </div>

        </div>
      </div>

      <div class="main-content">

        <!-- Saved Invoices Section --> </nav>
        </nav>

        <div id="saved-invoices" class="content-section">

          <h2>Saved Invoices</h2>

          <div class="invoices-actions">

            <button id="refresh-invoices" class="secondary-btn">Refresh</button> <!-- Loading Screen -->
            <!-- Loading Screen -->

          </div>

          <div id="saved-invoices-list">
            <div id="loading-screen" class="loading-screen">
              <div id="loading-screen" class="loading-screen">

                <p>Loading saved invoices...</p>

              </div>
              <div class="loading-content">
                <div class="loading-content">

                </div>

                <div class="spinner"></div>
                <div class="spinner"></div>

                <!-- Profile Settings Section -->

                <div id="profile-section" class="content-section hidden">
                  <p>Loading Dashboard...</p>
                  <p>Loading Dashboard...</p>

                  <h2>Profile Settings</h2>

                </div>
              </div>

              <!-- Profile Tabs -->

              <div class="profile-tabs"> </div>
            </div>

            <button type="button" class="tab-btn active" data-tab="company-tab">Company Details</button>

            <button type="button" class="tab-btn" data-tab="banking-tab">Banking & Payment</button>

          </div>

          <!-- Main Dashboard --> <!-- Main Dashboard -->

          <form id="profile-form">

            <!-- Company Details Tab -->
            <div id="dashboard-main" class="dashboard-container" style="display: none;">
              <div id="dashboard-main" class="dashboard-container" style="display: none;">

                <div id="company-tab" class="tab-content active">

                  <div class="form-group">
                    <div class="sidebar">
                      <div class="sidebar">

                        <label for="display-name">Display Name:</label>

                        <input type="text" id="display-name">
                        <ul class="menu">
                          <ul class="menu">

                      </div>

                      <li><a href="#" class="menu-item active" data-section="saved-invoices">üìã Saved Invoices</a></li>
                      <li><a href="#" class="menu-item active" data-section="saved-invoices">üìã Saved Invoices</a></li>

                      <div class="form-group">

                        <label for="default-seller-name">Default Seller Name:</label>
                        <li><a href="#" class="menu-item" data-section="profile-section">‚öôÔ∏è Profile Settings</a></li>
                        <li><a href="#" class="menu-item" data-section="profile-section">‚öôÔ∏è Profile Settings</a></li>

                        <input type="text" id="default-seller-name">

                      </div>
                      <li><a href="index.html" class="menu-item">üìÑ Create New Invoice</a></li>
                      <li><a href="index.html" class="menu-item">üìÑ Create New Invoice</a></li>



                      <div class="form-group">
                        </ul>
                        </ul>

                        <label for="default-seller-address">Default Seller Address:</label>

                        <input type="text" id="default-seller-address">
                      </div>
                    </div>

                  </div>



                  <div class="form-group">

                    <label for="default-seller-gst">Default Seller GST:</label>
                    <div class="main-content">
                      <div class="main-content">

                        <input type="text" id="default-seller-gst">

                      </div> <!-- Saved Invoices Section --> <!-- Saved Invoices Section -->



                      <div class="form-group">
                        <div id="saved-invoices" class="content-section">
                          <div id="saved-invoices" class="content-section">

                            <label for="company-logo">Company Logo:</label>

                            <input type="file" id="company-logo" accept="image/*">
                            <h2>Saved Invoices</h2>
                            <h2>Saved Invoices</h2>

                            <div id="logo-preview" class="logo-preview hidden">

                              <img id="logo-preview-img" src="" alt="Logo Preview">
                              <div class="invoices-actions">
                                <div class="invoices-actions">

                                  <button type="button" id="remove-logo" class="remove-logo-btn">Remove Logo</button>

                                </div> <button id="refresh-invoices" class="secondary-btn">Refresh</button> <button
                                  id="refresh-invoices" class="secondary-btn">Refresh</button>

                              </div>

                            </div>
                          </div>
                        </div>



                        <!-- Banking Details Tab -->
                        <div id="saved-invoices-list">
                          <div id="saved-invoices-list">

                            <div id="banking-tab" class="tab-content hidden">

                              <div class="form-group">
                                <p>Loading saved invoices...</p>
                                <p>Loading saved invoices...</p>

                                <label for="bank-name">Bank Name:</label>

                                <input type="text" id="bank-name" placeholder="e.g., State Bank of India">
                              </div>
                            </div>

                          </div>

                        </div>
                      </div>

                      <div class="form-group">

                        <label for="account-holder">Account Holder Name:</label>

                        <input type="text" id="account-holder" placeholder="Account holder name">

                      </div> <!-- Profile Settings Section --> <!-- Profile Settings Section -->



                      <div class="form-group">
                        <div id="profile-section" class="content-section hidden">
                          <div id="profile-section" class="content-section hidden">

                            <label for="account-number">Account Number:</label>

                            <input type="text" id="account-number" placeholder="Account number">
                            <h2>Profile Settings</h2>
                            <h2>Profile Settings</h2>

                          </div>



                          <div class="form-group">

                            <label for="ifsc-code">IFSC Code:</label> <!-- Profile Tabs --> <!-- Profile Tabs -->

                            <input type="text" id="ifsc-code" placeholder="e.g., SBIN0001234">

                          </div>
                          <div class="profile-tabs">
                            <div class="profile-tabs">



                              <div class="form-group"> <button type="button" class="tab-btn active"
                                  data-tab="company-tab">Company Details</button> <button type="button"
                                  class="tab-btn active" data-tab="company-tab">Company Details</button>

                                <label for="branch-name">Branch Name:</label>

                                <input type="text" id="branch-name" placeholder="Branch name"> <button type="button"
                                  class="tab-btn" data-tab="banking-tab">Banking & Payment</button> <button
                                  type="button" class="tab-btn" data-tab="banking-tab">Banking & Payment</button>

                              </div>

                            </div>
                          </div>

                          <div class="form-group">

                            <label for="upi-id">UPI ID:</label>

                            <input type="text" id="upi-id" placeholder="e.g., yourname@paytm">

                          </div>
                          <form id="profile-form">
                            <form id="profile-form">



                              <div class="form-group"> <!-- Company Details Tab --> <!-- Company Details Tab -->

                                <label for="upi-qr-code">UPI QR Code:</label>

                                <input type="file" id="upi-qr-code" accept="image/*">
                                <div id="company-tab" class="tab-content active">
                                  <div id="company-tab" class="tab-content active">

                                    <div id="qr-preview" class="logo-preview hidden">

                                      <img id="qr-preview-img" src="" alt="QR Code Preview">
                                      <div class="form-group">
                                        <div class="form-group">

                                          <button type="button" id="remove-qr" class="remove-logo-btn">Remove QR
                                            Code</button>

                                        </div> <label for="display-name">Display Name:</label> <label
                                          for="display-name">Display Name:</label>

                                      </div>

                                    </div> <input type="text" id="display-name"> <input type="text" id="display-name">



                                    <button type="submit">Update Profile</button>
                                  </div>
                                </div>

                            </form>

                        </div>

                      </div>

                    </div>
                    <div class="form-group">
                      <div class="form-group">



                        <script type="module">              <label for="default-seller-name">Default Seller Name:</label>              <label for="default-seller-name">Default Seller Name:</label>

                          import { authManager } from './js/auth.js';

                          import { invoiceStorage } from './js/invoice-storage.js'; <input type="text" id="default-seller-name">              <input type="text" id="default-seller-name">



                            let savedInvoices = [];            </div>            </div>



                          // Global functions used by inline onclick handlers

                          window.viewInvoice = async function (invoiceId) {

                            const invoice = savedInvoices.find(inv => inv.id === invoiceId); <div class="form-group">            <div class="form-group">

                              if (invoice) {

        const newWindow = window.open('', '_blank');              <label for="default-seller-address">Default Seller Address:</label>              <label for="default-seller-address">Default Seller Address:</label>

                              const htmlContent = await generateInvoiceHTML(invoice);

                              newWindow.document.write(htmlContent);              <input type="text" id="default-seller-address">              <input type="text" id="default-seller-address">

                                newWindow.document.close();

      }            </div>            </div>

    };



                              window.downloadInvoice = async function(invoiceId) {

      const invoice = savedInvoices.find(inv => inv.id === invoiceId);            <div class="form-group">            <div class="form-group">

                                if (invoice) {

                                  await generateInvoicePDF(invoice);              <label for="default-seller-gst">Default Seller GST:</label>              <label for="default-seller-gst">Default Seller GST:</label>

      }

    };              <input type="text" id="default-seller-gst">              <input type="text" id="default-seller-gst">



                                  window.deleteInvoice = async function (invoiceId) {            </div>            </div>

                                if (confirm('Are you sure you want to delete this invoice?')) {

        const result = await invoiceStorage.deleteInvoice(invoiceId);

                                if (result.success) {

                                  alert('Invoice deleted successfully!');            <div class="form-group">            <div class="form-group">

                                    loadSavedInvoices();

        } else {              <label for="company-logo">Company Logo:</label>              <label for="company-logo">Company Logo:</label>

          alert('Failed to delete invoice: ' + result.message);

        }              <input type="file" id="company-logo" accept="image/*">              <input type="file" id="company-logo" accept="image/*">

      }

    };              <div id="logo-preview" class="logo-preview hidden">              <div id="logo-preview" class="logo-preview hidden">



                                        document.addEventListener('DOMContentLoaded', async function () {<img id="logo-preview-img" src="" alt="Logo Preview">                <img id="logo-preview-img" src="" alt="Logo Preview">

                                          const user = await authManager.waitForAuthState();

                                          <button type="button" id="remove-logo" class="remove-logo-btn">Remove Logo</button>                <button type="button" id="remove-logo" class="remove-logo-btn">Remove Logo</button>

                                          if (!user) {

                                            window.location.href = 'login.html';              </div>              </div>

        return;

      }            </div>            </div>



                                      document.getElementById('loading-screen').style.display = 'none';          </div>          </div>

                                  document.getElementById('dashboard-main').style.display = 'flex';



                                  initTabFunctionality();

                                  initImagePreview();          <!-- Banking Details Tab -->          <!-- Banking Details Tab -->

                                  loadProfileData();

                                  <div id="banking-tab" class="tab-content hidden">          <div id="banking-tab" class="tab-content hidden">

                                    document.getElementById('profile-form').addEventListener('submit', async function (e) {

                                      e.preventDefault();            <div class="form-group">            <div class="form-group">

                                        await saveProfileData();

      });              <label for="bank-name">Bank Name:</label>              <label for="bank-name">Bank Name:</label>



                                        document.getElementById('logout-btn').addEventListener('click', function () {<input type="text" id="bank-name" placeholder="e.g., State Bank of India">              <input type="text" id="bank-name" placeholder="e.g., State Bank of India">

                                          authManager.logout();

      });            </div>            </div>



      loadSavedInvoices();



                                        document.getElementById('refresh-invoices').addEventListener('click', function () {<div class="form-group">            <div class="form-group">

                                          loadSavedInvoices();

      });              <label for="account-holder">Account Holder Name:</label>              <label for="account-holder">Account Holder Name:</label>



                                          const menuItems = document.querySelectorAll('.menu-item');              <input type="text" id="account-holder" placeholder="Account holder name">              <input type="text" id="account-holder" placeholder="Account holder name">

                                            const contentSections = document.querySelectorAll('.content-section');

                                          </div>            </div>

      menuItems.forEach(item => {

                                            item.addEventListener('click', function (e) {

                                              e.preventDefault();

                                              menuItems.forEach(mi => mi.classList.remove('active')); <div class="form-group">            <div class="form-group">

          contentSections.forEach(cs => cs.classList.add('hidden'));

                                                this.classList.add('active');              <label for="account-number">Account Number:</label>              <label for="account-number">Account Number:</label>



                                                const section = this.getAttribute('data-section');              <input type="text" id="account-number" placeholder="Account number">              <input type="text" id="account-number" placeholder="Account number">

                                                  const targetSection = document.getElementById(section);

                                                  if (targetSection) {            </div>            </div>

                                                targetSection.classList.remove('hidden');

                                                if (section === 'profile-section') {

                                                  loadProfileData();

            }            <div class="form-group">            <div class="form-group">

          }

        });              <label for="ifsc-code">IFSC Code:</label>              <label for="ifsc-code">IFSC Code:</label>

      });

    });              <input type="text" id="ifsc-code" placeholder="e.g., SBIN0001234">              <input type="text" id="ifsc-code" placeholder="e.g., SBIN0001234">



                                                    async function loadSavedInvoices() {            </div>            </div>

                                                  const invoicesList = document.getElementById('saved-invoices-list');

                                                  invoicesList.innerHTML = '<p>Loading...</p>';



                                                  const result = await invoiceStorage.getAllInvoices();            <div class="form-group">            <div class="form-group">

      if (result.success && result.invoices.length > 0) {

                                                      savedInvoices = result.invoices;              <label for="branch-name">Branch Name:</label>              <label for="branch-name">Branch Name:</label>

                                                    let invoicesHtml = '<div class="invoices-grid">';

                                                      <input type="text" id="branch-name" placeholder="Branch name">              <input type="text" id="branch-name" placeholder="Branch name">

        result.invoices.forEach(invoice => {

                                                          invoicesHtml += `            </div>            </div>

            <div class="invoice-card">

              <div class="invoice-header">

                <h3>Invoice #${invoice.invoiceNumber}</h3>

                <span class="invoice-date">${invoice.date}</span>            <div class="form-group">            <div class="form-group">

              </div>

              <div class="invoice-details">              <label for="upi-id">UPI ID:</label>              <label for="upi-id">UPI ID:</label>

                <p><strong>Buyer:</strong> ${invoice.buyer.name}</p>

                <p><strong>Amount:</strong> ‚Çπ${invoice.totalAmount.toFixed(2)}</p>              <input type="text" id="upi-id" placeholder="e.g., yourname@paytm">              <input type="text" id="upi-id" placeholder="e.g., yourname@paytm">

              </div>

              <div class="invoice-actions">            </div>            </div>

                <button class="view-btn" onclick="viewInvoice('${invoice.id}')">View</button>

                <button class="download-btn" onclick="downloadInvoice('${invoice.id}')">Download</button>

                <button class="delete-btn" onclick="deleteInvoice('${invoice.id}')">Delete</button>

              </div>            <div class="form-group">            <div class="form-group">

            </div>

          `;              <label for="upi-qr-code">UPI QR Code:</label>              <label for="upi-qr-code">UPI QR Code:</label>

        });

                                                        <input type="file" id="upi-qr-code" accept="image/*">              <input type="file" id="upi-qr-code" accept="image/*">

                                                          invoicesHtml += '</div>';

                                                          invoicesList.innerHTML = invoicesHtml;              <div id="qr-preview" class="logo-preview hidden">              <div id="qr-preview" class="logo-preview hidden">

      } else if (result.success && result.invoices.length === 0) {

                                                              invoicesList.innerHTML = '<p>No saved invoices found. <a href="index.html">Create your first invoice</a></p>';                <img id="qr-preview-img" src="" alt="QR Code Preview">                <img id="qr-preview-img" src="" alt="QR Code Preview">

      } else {

                                                                  invoicesList.innerHTML = '<p>Error loading invoices: ' + result.message + '</p>';                <button type="button" id="remove-qr" class="remove-logo-btn">Remove QR Code</button>                <button type="button" id="remove-qr" class="remove-logo-btn">Remove QR Code</button>

      }

    }              </div>              </div>



                                                            async function generateInvoiceHTML(invoice) {            </div>            </div>

                                                        const logoUrl = window.authManager ? await window.authManager.getCompanyLogo() : 'assets/images/logo.png';

                                                      </div>          </div>

                                                    let itemsHtml = '';

      invoice.items.forEach(item => {

                                                      itemsHtml += `

          <tr>          <button type="submit">Update Profile</button>          <button type="submit">Update Profile</button>

            <td>${item.description}</td>

            <td style="text-align: center;">${item.quantity}</td>        </form>        </form>

            <td style="text-align: right;">‚Çπ${item.price.toFixed(2)}</td>

            <td style="text-align: right;">‚Çπ${item.total.toFixed(2)}</td>      </div>      </div>

          </tr>

        `;    </div>    </div>

      });

                                                </div>  </div>

                                              return `

        <!DOCTYPE html>

        <html>

        <head>  <script type="module">  <script type="module">

          <title>Invoice ${invoice.invoiceNumber}</title>

          <style>    import { authManager } from './js/auth.js';    import { authManager } from './js/auth.js';

            body { font-family: Arial, sans-serif; margin: 20px; }

            .invoice-header { text-align: center; border-bottom: 2px solid #333; padding-bottom: 20px; margin-bottom: 30px; }    import { invoiceStorage } from './js/invoice-storage.js';    import { invoiceStorage } from './js/invoice-storage.js';

            .invoice-logo { height: 60px; width: auto; margin-bottom: 10px; }

            .details-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-bottom: 30px; }

            .details-section { padding: 15px; background-color: #f8f9fa; border-radius: 4px; }

            table { width: 100%; border-collapse: collapse; margin: 20px 0; }    let savedInvoices = [];    let savedInvoices = [];

            th, td { padding: 10px; text-align: left; border: 1px solid #ddd; }

            th { background-color: #f8f9fa; }

            .totals { text-align: right; margin-top: 20px; }

            .total-row { margin: 5px 0; }    // Global functions used by inline onclick handlers    // Global functions used by inline onclick handlers

            .final-total { font-weight: bold; font-size: 18px; border-top: 1px solid #333; padding-top: 10px; }

          </style>    window.viewInvoice = async function(invoiceId) {    window.viewInvoice = async function (invoiceId) {

        </head>

        <body>      const invoice = savedInvoices.find(inv => inv.id === invoiceId);      const invoice = savedInvoices.find(inv => inv.id === invoiceId);

          <div class="invoice-header">

            <img src="${logoUrl}" alt="Logo" class="invoice-logo">      if (invoice) {      if (invoice) {

            <h1>GST INVOICE</h1>

            <p>Invoice Number: ${invoice.invoiceNumber}</p>        // Open invoice in a new window/modal        // Open invoice in a new window/modal

            <p>Date: ${invoice.date}</p>

          </div>        const newWindow = window.open('', '_blank');        const newWindow = window.open('', '_blank');

          

          <div class="details-grid">        const htmlContent = await generateInvoiceHTML(invoice);        const htmlContent = await generateInvoiceHTML(invoice);

            <div class="details-section">

              <h3>Seller Details:</h3>        newWindow.document.write(htmlContent);        newWindow.document.write(htmlContent);

              <p><strong>Name:</strong> ${invoice.seller.name}</p>

              ${invoice.seller.address ? `<p><strong>Address:</strong> ${invoice.seller.address}</p>` : ''}        newWindow.document.close();        newWindow.document.close();

              ${invoice.seller.gst ? `<p><strong>GST Number:</strong> ${invoice.seller.gst}</p>` : ''}

            </div>      }      }

            <div class="details-section">

              <h3>Buyer Details:</h3>    };    };

              <p><strong>Name:</strong> ${invoice.buyer.name}</p>

              ${invoice.buyer.address ? `<p><strong>Address:</strong> ${invoice.buyer.address}</p>` : ''}

              ${invoice.buyer.gst ? `<p><strong>GST Number:</strong> ${invoice.buyer.gst}</p>` : ''}

            </div>    window.downloadInvoice = async function(invoiceId) {    window.downloadInvoice = async function (invoiceId) {

          </div>

                const invoice = savedInvoices.find(inv => inv.id === invoiceId);      const invoice = savedInvoices.find(inv => inv.id === invoiceId);

          <table>

            <thead>      if (invoice) {      if (invoice) {

              <tr>

                <th>Description</th>        // Use existing PDF generator        // Use existing PDF generator

                <th style="text-align: center;">Quantity</th>

                <th style="text-align: right;">Unit Price</th>        await generateInvoicePDF(invoice);        await generateInvoicePDF(invoice);

                <th style="text-align: right;">Total</th>

              </tr>      }      }

            </thead>

            <tbody>    };    };

              ${itemsHtml}

            </tbody>

          </table>

              window.deleteInvoice = async function (invoiceId) {    window.deleteInvoice = async function (invoiceId) {

          <div class="totals">

            <div class="total-row">Subtotal: ‚Çπ${invoice.subtotal.toFixed(2)}</div>      if (confirm('Are you sure you want to delete this invoice?')) {      if (confirm('Are you sure you want to delete this invoice?')) {

            <div class="total-row">CGST (2.5%): ‚Çπ${invoice.cgstAmount.toFixed(2)}</div>

            <div class="total-row">SGST (2.5%): ‚Çπ${invoice.sgstAmount.toFixed(2)}</div>        const result = await invoiceStorage.deleteInvoice(invoiceId);        const result = await invoiceStorage.deleteInvoice(invoiceId);

            <div class="total-row final-total">Grand Total: ‚Çπ${invoice.totalAmount.toFixed(2)}</div>

          </div>        if (result.success) {        if (result.success) {

          

          ${await getBankingDetailsHTML()}          alert('Invoice deleted successfully!');          alert('Invoice deleted successfully!');

        </body>

        </html>          loadSavedInvoices(); // Refresh the list          loadSavedInvoices(); // Refresh the list

      `;

                                            }        } else { } else {



                                            async function getBankingDetailsHTML() {
                                              alert('Failed to delete invoice: ' + result.message); alert('Failed to delete invoice: ' + result.message);

                                              try {

                                                if (!authManager.currentUser) return '';
                                              }        }

        

        const profile = await authManager.getUserProfile(authManager.currentUser.uid);      }      }

                                          if (!profile?.banking && !profile?.upiQrCode) return '';

    };    };

                                          let bankingHtml = '<div style="margin-top: 30px; padding-top: 20px; border-top: 1px solid #ddd;"><h3>Payment Details:</h3>';



                                            if (profile.banking) {

          const banking = profile.banking;    document.addEventListener('DOMContentLoaded', async function () {document.addEventListener('DOMContentLoaded', async function () {

                                              bankingHtml += '<div style="margin-bottom: 15px;">';

                                              if (banking.bankName) bankingHtml += `<p><strong>Bank:</strong> ${banking.bankName}</p>`;      // Wait for auth state to be determined      // Wait for auth state to be determined

                                              if (banking.accountHolder) bankingHtml += `<p><strong>Account Holder:</strong> ${banking.accountHolder}</p>`;

                                              if (banking.accountNumber) bankingHtml += `<p><strong>Account Number:</strong> ${banking.accountNumber}</p>`; const user = await authManager.waitForAuthState(); const user = await authManager.waitForAuthState();

                                              if (banking.ifscCode) bankingHtml += `<p><strong>IFSC Code:</strong> ${banking.ifscCode}</p>`;

                                              if (banking.branchName) bankingHtml += `<p><strong>Branch:</strong> ${banking.branchName}</p>`;

                                              if (banking.upiId) bankingHtml += `<p><strong>UPI ID:</strong> ${banking.upiId}</p>`;

                                              bankingHtml += '</div>'; if (!user) {
                                                if (!user) {

                                                }

                                                window.location.href = 'login.html'; window.location.href = 'login.html';

                                                if (profile.upiQrCode) {

                                                  bankingHtml += `<div style="text-align: center; margin-top: 15px;">        return;        return;

            <p><strong>UPI QR Code:</strong></p>

            <img src="${profile.upiQrCode}" alt="UPI QR Code" style="height: 120px; width: 120px;">      }      }

          </div>`;

                                                }



                                                bankingHtml += '</div>';      // Hide loading screen and show dashboard      // Hide loading screen and show dashboard

                                                return bankingHtml;

                                              } catch (error) {
                                                document.getElementById('loading-screen').style.display = 'none'; document.getElementById('loading-screen').style.display = 'none';

                                                console.error('Error getting banking details:', error);

                                                return ''; document.getElementById('dashboard-main').style.display = 'flex'; document.getElementById('dashboard-main').style.display = 'flex';

                                              }

                                            }



    async function generateInvoicePDF(invoice) {      // Tab functionality      // Tab functionality

                                                const printWindow = window.open('', '_blank');

                                                const htmlContent = await generateInvoiceHTML(invoice); initTabFunctionality(); initTabFunctionality();

                                                printWindow.document.write(htmlContent);

                                                printWindow.document.close();

                                                printWindow.onload = function () {

                                                  setTimeout(function () {      // Logo and QR code preview functionality      // Logo and QR code preview functionality

                                                    printWindow.print();

                                                  }, 500); initImagePreview(); initImagePreview();

                                                };

                                              }



    function initTabFunctionality() {      // Load profile data      // Load profile data

                                                const tabButtons = document.querySelectorAll('.tab-btn');

                                                const tabContents = document.querySelectorAll('.tab-content'); loadProfileData(); loadProfileData();



                                                tabButtons.forEach(button => {

                                                  button.addEventListener('click', function () {

                                                    const targetTab = this.getAttribute('data-tab');      // Profile form submission      // Profile form submission

                                                    tabButtons.forEach(btn => btn.classList.remove('active'));

                                                    tabContents.forEach(content => content.classList.remove('active')); document.getElementById('profile-form').addEventListener('submit', async function (e) {
                                                      document.getElementById('profile-form').addEventListener('submit', async function (e) {

                                                        this.classList.add('active');

                                                        document.getElementById(targetTab).classList.add('active'); e.preventDefault(); e.preventDefault();

                                                      });

                                                    }); await saveProfileData(); await saveProfileData();

                                                  }

      });
                                              });

                                            function initImagePreview() {

                                              document.getElementById('company-logo').addEventListener('change', function (e) {

                                                const file = e.target.files[0];

                                                if (file) {      // Logout functionality      // Logout functionality

                                                  const reader = new FileReader();

                                                  reader.onload = function (e) {
                                                    document.getElementById('logout-btn').addEventListener('click', function () {
                                                      document.getElementById('logout-btn').addEventListener('click', function () {

                                                        const logoPreview = document.getElementById('logo-preview');

                                                        const logoImg = document.getElementById('logo-preview-img'); authManager.logout(); authManager.logout();

                                                        logoImg.src = e.target.result;

                                                        logoPreview.classList.remove('hidden');
                                                      });
                                                    });

                                                  };

                                                  reader.readAsDataURL(file);

                                                }

                                              });      // Load saved invoices when the saved section is opened      // Load saved invoices when the saved section is opened



                                            document.getElementById('remove-logo').addEventListener('click', function () {loadSavedInvoices();      loadSavedInvoices();

                                            document.getElementById('company-logo').value = '';

                                            document.getElementById('logo-preview').classList.add('hidden');

                                            document.getElementById('logo-preview-img').src = '';

      });      // Refresh invoices button      // Refresh invoices button



                                            document.getElementById('upi-qr-code').addEventListener('change', function (e) {document.getElementById('refresh-invoices').addEventListener('click', function () {
                                              document.getElementById('refresh-invoices').addEventListener('click', function () {

                                                const file = e.target.files[0];

                                                if (file) {
                                                  loadSavedInvoices(); loadSavedInvoices();

                                                  const reader = new FileReader();

                                                  reader.onload = function (e) { });
                                            });

                                            const qrPreview = document.getElementById('qr-preview');

                                            const qrImg = document.getElementById('qr-preview-img');

                                            qrImg.src = e.target.result;

                                            qrPreview.classList.remove('hidden');      // Sidebar navigation      // Sidebar navigation

          };

                                            reader.readAsDataURL(file);      const menuItems = document.querySelectorAll('.menu-item');      const menuItems = document.querySelectorAll('.menu-item');

        }

      });      const contentSections = document.querySelectorAll('.content-section');      const contentSections = document.querySelectorAll('.content-section');



                                            document.getElementById('remove-qr').addEventListener('click', function () {

                                              document.getElementById('upi-qr-code').value = '';

        document.getElementById('qr-preview').classList.add('hidden');      menuItems.forEach(item => {menuItems.forEach(item => {

                                                document.getElementById('qr-preview-img').src = '';

                                              });        item.addEventListener('click', function (e) {item.addEventListener('click', function (e) {

                                              }

          e.preventDefault();          e.preventDefault();

                                            async function loadProfileData() {

      if (!authManager.currentUser) return;



                                            try {          // Remove active class from all items          // Remove active class from all items

        const profile = await authManager.getUserProfile(authManager.currentUser.uid);

                                            if (profile) {menuItems.forEach(mi => mi.classList.remove('active'));          menuItems.forEach(mi => mi.classList.remove('active'));

                                            document.getElementById('display-name').value = profile.displayName || '';

          document.getElementById('default-seller-name').value = profile.defaultSellerName || '';          contentSections.forEach(cs => cs.classList.add('hidden'));          contentSections.forEach(cs => cs.classList.add('hidden'));

                                            document.getElementById('default-seller-address').value = profile.defaultSellerAddress || '';

                                            document.getElementById('default-seller-gst').value = profile.defaultSellerGst || '';



                                            if (profile.companyLogo) {          // Add active class to clicked item          // Add active class to clicked item

            const logoPreview = document.getElementById('logo-preview');

                                            const logoImg = document.getElementById('logo-preview-img');          this.classList.add('active');          this.classList.add('active');

                                            logoImg.src = profile.companyLogo;

                                            logoPreview.classList.remove('hidden');

          }

                                            // Show corresponding content section          // Show corresponding content section

                                            if (profile.banking) {

                                              document.getElementById('bank-name').value = profile.banking.bankName || '';          const section = this.getAttribute('data-section');          const section = this.getAttribute('data-section');

                                            document.getElementById('account-holder').value = profile.banking.accountHolder || '';

                                            document.getElementById('account-number').value = profile.banking.accountNumber || '';          const targetSection = document.getElementById(section);          const targetSection = document.getElementById(section);

                                            document.getElementById('ifsc-code').value = profile.banking.ifscCode || '';

                                            document.getElementById('branch-name').value = profile.banking.branchName || '';          if (targetSection) {          if (targetSection) {

                                              document.getElementById('upi-id').value = profile.banking.upiId || '';

          }            targetSection.classList.remove('hidden');            targetSection.classList.remove('hidden');



                                            if (profile.upiQrCode) {            

            const qrPreview = document.getElementById('qr-preview');

                                            const qrImg = document.getElementById('qr-preview-img');            // If switching to profile section, load the data            // If switching to profile section, load the data

                                            qrImg.src = profile.upiQrCode;

                                            qrPreview.classList.remove('hidden');            if (section === 'profile-section') {            if (section === 'profile-section') {

                                            }

        }              loadProfileData();              loadProfileData();

      } catch (error) {

                                              console.error('Error loading profile:', error);            }            }

      }

    }          }          }



                                            async function saveProfileData() { });        });

                                            if (!authManager.currentUser) return;

      });      });

                                            const profileData = {

                                              displayName: document.getElementById('display-name').value,    });    });

                                            defaultSellerName: document.getElementById('default-seller-name').value,

                                            defaultSellerAddress: document.getElementById('default-seller-address').value,

                                            defaultSellerGst: document.getElementById('default-seller-gst').value,

                                            email: authManager.currentUser.email,    async function loadSavedInvoices() {async function loadSavedInvoices() {

                                              updatedAt: new Date().toISOString()

                                            };      const invoicesList = document.getElementById('saved-invoices-list');      const invoicesList = document.getElementById('saved-invoices-list');



                                            const bankingData = {invoicesList.innerHTML = '<p>Loading...</p>';      invoicesList.innerHTML = '<p>Loading...</p>';

                                            bankName: document.getElementById('bank-name').value,

                                            accountHolder: document.getElementById('account-holder').value,

                                            accountNumber: document.getElementById('account-number').value,

                                            ifscCode: document.getElementById('ifsc-code').value,      const result = await invoiceStorage.getAllInvoices();      const result = await invoiceStorage.getAllInvoices();

                                            branchName: document.getElementById('branch-name').value,

        upiId: document.getElementById('upi-id').value      if (result.success && result.invoices.length > 0) {      if (result.success && result.invoices.length > 0) {

                                            };

                                            savedInvoices = result.invoices;        savedInvoices = result.invoices;

      if (Object.values(bankingData).some(value => value.trim() !== '')) {

                                              profileData.banking = bankingData;        let invoicesHtml = '<div class="invoices-grid">';        let invoicesHtml = '<div class="invoices-grid">';

      }



                                                const logoImg = document.getElementById('logo-preview-img');

                                                if (logoImg.src && !logoImg.src.includes('assets/images/')) {result.invoices.forEach(invoice => {
                                                  result.invoices.forEach(invoice => {

                                                    profileData.companyLogo = logoImg.src;

                                                  }          invoicesHtml += `          invoicesHtml += `



      const qrImg = document.getElementById('qr-preview-img'); <div class="invoice-card">            <div class="invoice-card">

                                                    if (qrImg.src && qrImg.src.trim() !== '') {

                                                      profileData.upiQrCode = qrImg.src;              <div class="invoice-header">              <div class="invoice-header">

      }

                                                        <h3>Invoice #${invoice.invoiceNumber}</h3>                <h3>Invoice #${invoice.invoiceNumber}</h3>

                                                        try {

                                                          await authManager.createUserProfile(authManager.currentUser.uid, profileData);                <span class="invoice-date">${invoice.date}</span>                <span class="invoice-date">${invoice.date}</span>

                                                        alert('Profile updated successfully!');

      } catch (error) {              </div>              </div>

                                                    console.error('Error saving profile:', error);

                                                    alert('Error saving profile: ' + error.message);              <div class="invoice-details">              <div class="invoice-details">

      }

    }                <p><strong>Buyer:</strong> ${invoice.buyer.name}</p>                <p><strong>Buyer:</strong> ${invoice.buyer.name}</p>

                        </script>

    </body>
    <p><strong>Amount:</strong> ‚Çπ${invoice.totalAmount.toFixed(2)}</p>
    <p><strong>Amount:</strong> ‚Çπ${invoice.totalAmount.toFixed(2)}</p>



</html>
</div>
</div>

<div class="invoice-actions">
  <div class="invoice-actions">

    <button class="view-btn" onclick="viewInvoice('${invoice.id}')">View</button> <button class="view-btn"
      onclick="viewInvoice('${invoice.id}')">View</button>

    <button class="download-btn" onclick="downloadInvoice('${invoice.id}')">Download</button> <button
      class="download-btn" onclick="downloadInvoice('${invoice.id}')">Download</button>

    <button class="delete-btn" onclick="deleteInvoice('${invoice.id}')">Delete</button> <button class="delete-btn"
      onclick="deleteInvoice('${invoice.id}')">Delete</button>

  </div>
</div>

</div>
</div>

`; `;

}); });



invoicesHtml += '</div>'; invoicesHtml += '</div>';

invoicesList.innerHTML = invoicesHtml; invoicesList.innerHTML = invoicesHtml;

} else if (result.success && result.invoices.length === 0) { } else if (result.success && result.invoices.length === 0)
{

invoicesList.innerHTML = '<p>No saved invoices found. <a href="index.html">Create your first invoice</a></p>';
invoicesList.innerHTML = '<p>No saved invoices found. <a href="index.html">Create your first invoice</a></p>';

} else { } else {

invoicesList.innerHTML = '<p>Error loading invoices: ' + result.message + '</p>'; invoicesList.innerHTML = '<p>Error
  loading invoices: ' + result.message + '</p>';

} }

} }



async function generateInvoiceHTML(invoice) { async function generateInvoiceHTML(invoice) {

// Get company logo // Get company logo

const logoUrl = window.authManager ? await window.authManager.getCompanyLogo() : 'assets/images/logo.png'; const logoUrl
= window.authManager ? await window.authManager.getCompanyLogo() : 'assets/images/logo.png';



let itemsHtml = ''; let itemsHtml = '';

invoice.items.forEach(item => { invoice.items.forEach(item => {

itemsHtml += ` itemsHtml += `

<tr>
<tr>

  <td>${item.description}</td>
  <td>${item.description}</td>

  <td style="text-align: center;">${item.quantity}</td>
  <td style="text-align: center;">${item.quantity}</td>

  <td style="text-align: right;">‚Çπ${item.price.toFixed(2)}</td>
  <td style="text-align: right;">‚Çπ${item.price.toFixed(2)}</td>

  <td style="text-align: right;">‚Çπ${item.total.toFixed(2)}</td>
  <td style="text-align: right;">‚Çπ${item.total.toFixed(2)}</td>

</tr>
</tr>

`; `;

}); });



return ` return `

<!DOCTYPE html>
<!DOCTYPE html>

<html>
<html>

<head>

  <head>

    <title>Invoice ${invoice.invoiceNumber}</title>
    <title>Invoice ${invoice.invoiceNumber}</title>

    <style>
      <style>body {
        font-family: Arial, sans-serif;
        margin: 20px;
      }

      body {
        font-family: Arial, sans-serif;
        margin: 20px;
      }

      .invoice-header {
        text-align: center;
        border-bottom: 2px solid #333;
        padding-bottom: 20px;
        margin-bottom: 30px;
      }

      .invoice-header {
        text-align: center;
        border-bottom: 2px solid #333;
        padding-bottom: 20px;
        margin-bottom: 30px;
      }

      .invoice-logo {
        height: 60px;
        width: auto;
        margin-bottom: 10px;
      }

      .invoice-logo {
        height: 60px;
        width: auto;
        margin-bottom: 10px;
      }

      .details-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 30px;
        margin-bottom: 30px;
      }

      .details-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 30px;
        margin-bottom: 30px;
      }

      .details-section {
        padding: 15px;
        background-color: #f8f9fa;
        border-radius: 4px;
      }

      .details-section {
        padding: 15px;
        background-color: #f8f9fa;
        border-radius: 4px;
      }

      table {
        width: 100%;
        border-collapse: collapse;
        margin: 20px 0;
      }

      table {
        width: 100%;
        border-collapse: collapse;
        margin: 20px 0;
      }

      th,
      td {
        padding: 10px;
        text-align: left;
        border: 1px solid #ddd;
      }

      th,
      td {
        padding: 10px;
        text-align: left;
        border: 1px solid #ddd;
      }

      th {
        background-color: #f8f9fa;
      }

      th {
        background-color: #f8f9fa;
      }

      .totals {
        text-align: right;
        margin-top: 20px;
      }

      .totals {
        text-align: right;
        margin-top: 20px;
      }

      .total-row {
        margin: 5px 0;
      }

      .total-row {
        margin: 5px 0;
      }

      .final-total {
        font-weight: bold;
        font-size: 18px;
        border-top: 1px solid #333;
        padding-top: 10px;
      }

      .final-total {
        font-weight: bold;
        font-size: 18px;
        border-top: 1px solid #333;
        padding-top: 10px;
      }
    </style>
    </style>

  </head>
</head>

<body>

  <body>

    <div class="invoice-header">
      <div class="invoice-header">

        <img src="${logoUrl}" alt="Logo" class="invoice-logo"> <img src="${logoUrl}" alt="Logo" class="invoice-logo">

        <h1>GST INVOICE</h1>
        <h1>GST INVOICE</h1>

        <p>Invoice Number: ${invoice.invoiceNumber}</p>
        <p>Invoice Number: ${invoice.invoiceNumber}</p>

        <p>Date: ${invoice.date}</p>
        <p>Date: ${invoice.date}</p>

      </div>
    </div>



    <div class="details-grid">
      <div class="details-grid">

        <div class="details-section">
          <div class="details-section">

            <h3>Seller Details:</h3>
            <h3>Seller Details:</h3>

            <p><strong>Name:</strong> ${invoice.seller.name}</p>
            <p><strong>Name:</strong> ${invoice.seller.name}</p>

            ${invoice.seller.address ? `<p><strong>Address:</strong> ${invoice.seller.address}</p>` : ''}
            ${invoice.seller.address ? `<p><strong>Address:</strong> ${invoice.seller.address}</p>` : ''}

            ${invoice.seller.gst ? `<p><strong>GST Number:</strong> ${invoice.seller.gst}</p>` : ''}
            ${invoice.seller.gst ? `<p><strong>GST Number:</strong> ${invoice.seller.gst}</p>` : ''}

          </div>
        </div>

        <div class="details-section">
          <div class="details-section">

            <h3>Buyer Details:</h3>
            <h3>Buyer Details:</h3>

            <p><strong>Name:</strong> ${invoice.buyer.name}</p>
            <p><strong>Name:</strong> ${invoice.buyer.name}</p>

            ${invoice.buyer.address ? `<p><strong>Address:</strong> ${invoice.buyer.address}</p>` : ''}
            ${invoice.buyer.address ? `<p><strong>Address:</strong> ${invoice.buyer.address}</p>` : ''}

            ${invoice.buyer.gst ? `<p><strong>GST Number:</strong> ${invoice.buyer.gst}</p>` : ''} ${invoice.buyer.gst ?
            `<p><strong>GST Number:</strong> ${invoice.buyer.gst}</p>` : ''}

          </div>
        </div>

      </div>
    </div>



    <table>
      <table>

        <thead>
          <thead>

            <tr>
            <tr>

              <th>Description</th>
              <th>Description</th>

              <th style="text-align: center;">Quantity</th>
              <th style="text-align: center;">Quantity</th>

              <th style="text-align: right;">Unit Price</th>
              <th style="text-align: right;">Unit Price</th>

              <th style="text-align: right;">Total</th>
              <th style="text-align: right;">Total</th>

            </tr>
            </tr>

          </thead>
        </thead>

        <tbody>
        <tbody>

          ${itemsHtml} ${itemsHtml}

        </tbody>
        </tbody>

      </table>
    </table>



    <div class="totals">
      <div class="totals">

        <div class="total-row">Subtotal: ‚Çπ${invoice.subtotal.toFixed(2)}</div>
        <div class="total-row">Subtotal: ‚Çπ${invoice.subtotal.toFixed(2)}</div>

        <div class="total-row">CGST (2.5%): ‚Çπ${invoice.cgstAmount.toFixed(2)}</div>
        <div class="total-row">CGST (2.5%): ‚Çπ${invoice.cgstAmount.toFixed(2)}</div>

        <div class="total-row">SGST (2.5%): ‚Çπ${invoice.sgstAmount.toFixed(2)}</div>
        <div class="total-row">SGST (2.5%): ‚Çπ${invoice.sgstAmount.toFixed(2)}</div>

        <div class="total-row final-total">Grand Total: ‚Çπ${invoice.totalAmount.toFixed(2)}</div>
        <div class="total-row final-total">Grand Total: ‚Çπ${invoice.totalAmount.toFixed(2)}</div>

      </div>
    </div>



    ${await getBankingDetailsHTML()} ${await getBankingDetailsHTML()}

  </body>
</body>

</html>

</html>

`; `;

} }



async function getBankingDetailsHTML() { async function getBankingDetailsHTML() {

try { try {

if (!authManager.currentUser) return ''; if (!authManager.currentUser) return '';



const profile = await authManager.getUserProfile(authManager.currentUser.uid); const profile = await
authManager.getUserProfile(authManager.currentUser.uid);

if (!profile?.banking && !profile?.upiQrCode) return ''; if (!profile?.banking && !profile?.upiQrCode) return '';



let bankingHtml = '<div style="margin-top: 30px; padding-top: 20px; border-top: 1px solid #ddd;">
  <h3>Payment Details:</h3>'; let bankingHtml = '<div
    style="margin-top: 30px; padding-top: 20px; border-top: 1px solid #ddd;">
    <h3>Payment Details:</h3>';



    if (profile.banking) { if (profile.banking) {

    const banking = profile.banking; const banking = profile.banking;

    bankingHtml += '<div style="margin-bottom: 15px;">'; bankingHtml += '<div style="margin-bottom: 15px;">';

        if (banking.bankName) bankingHtml += `<p><strong>Bank:</strong> ${banking.bankName}</p>`; if (banking.bankName)
        bankingHtml += `<p><strong>Bank:</strong> ${banking.bankName}</p>`;

        if (banking.accountHolder) bankingHtml += `<p><strong>Account Holder:</strong> ${banking.accountHolder}</p>`; if
        (banking.accountHolder) bankingHtml += `<p><strong>Account Holder:</strong> ${banking.accountHolder}</p>`;

        if (banking.accountNumber) bankingHtml += `<p><strong>Account Number:</strong> ${banking.accountNumber}</p>`; if
        (banking.accountNumber) bankingHtml += `<p><strong>Account Number:</strong> ${banking.accountNumber}</p>`;

        if (banking.ifscCode) bankingHtml += `<p><strong>IFSC Code:</strong> ${banking.ifscCode}</p>`; if
        (banking.ifscCode) bankingHtml += `<p><strong>IFSC Code:</strong> ${banking.ifscCode}</p>`;

        if (banking.branchName) bankingHtml += `<p><strong>Branch:</strong> ${banking.branchName}</p>`; if
        (banking.branchName) bankingHtml += `<p><strong>Branch:</strong> ${banking.branchName}</p>`;

        if (banking.upiId) bankingHtml += `<p><strong>UPI ID:</strong> ${banking.upiId}</p>`; if (banking.upiId)
        bankingHtml += `<p><strong>UPI ID:</strong> ${banking.upiId}</p>`;

        bankingHtml += '</div>'; bankingHtml += '</div>';

    } }



    if (profile.upiQrCode) { if (profile.upiQrCode) {

    bankingHtml += `<div style="text-align: center; margin-top: 15px;"> bankingHtml += `<div
        style="text-align: center; margin-top: 15px;">

        <p><strong>UPI QR Code:</strong></p>
        <p><strong>UPI QR Code:</strong></p>

        <img src="${profile.upiQrCode}" alt="UPI QR Code" style="height: 120px; width: 120px;"> <img
          src="${profile.upiQrCode}" alt="UPI QR Code" style="height: 120px; width: 120px;">

      </div>`; </div>`;

    } }



    bankingHtml += '
  </div>'; bankingHtml += '
</div>';

return bankingHtml; return bankingHtml;

} catch (error) { } catch (error) {

console.error('Error getting banking details:', error); console.error('Error getting banking details:', error);

return ''; return '';

} }

} }



async function generateInvoicePDF(invoice) { async function generateInvoicePDF(invoice) {

const printWindow = window.open('', '_blank'); const printWindow = window.open('', '_blank');

const htmlContent = await generateInvoiceHTML(invoice); const htmlContent = await generateInvoiceHTML(invoice);

printWindow.document.write(htmlContent); printWindow.document.write(htmlContent);

printWindow.document.close(); printWindow.document.close();

printWindow.onload = function () { printWindow.onload = function () {

setTimeout(function () { setTimeout(function () {

printWindow.print(); printWindow.print();

}, 500); }, 500);

}; };

} }



function initTabFunctionality() { function initTabFunctionality() {

const tabButtons = document.querySelectorAll('.tab-btn'); const tabButtons = document.querySelectorAll('.tab-btn');

const tabContents = document.querySelectorAll('.tab-content'); const tabContents =
document.querySelectorAll('.tab-content');



tabButtons.forEach(button => { tabButtons.forEach(button => {

button.addEventListener('click', function() { button.addEventListener('click', function () {

const targetTab = this.getAttribute('data-tab'); const targetTab = this.getAttribute('data-tab');



// Remove active class from all tabs and contents // Remove active class from all tabs and contents

tabButtons.forEach(btn => btn.classList.remove('active')); tabButtons.forEach(btn => btn.classList.remove('active'));

tabContents.forEach(content => content.classList.remove('active')); tabContents.forEach(content =>
content.classList.remove('active'));



// Add active class to clicked tab and corresponding content // Add active class to clicked tab and corresponding
content

this.classList.add('active'); this.classList.add('active');

document.getElementById(targetTab).classList.add('active'); document.getElementById(targetTab).classList.add('active');

}); });

}); });

} }



function initImagePreview() { function initImagePreview() {

// Logo upload handling // Logo upload handling

document.getElementById('company-logo').addEventListener('change', function (e) {
document.getElementById('company-logo').addEventListener('change', function (e) {

const file = e.target.files[0]; const file = e.target.files[0];

if (file) { if (file) {

const reader = new FileReader(); const reader = new FileReader();

reader.onload = function (e) { reader.onload = function (e) {

const logoPreview = document.getElementById('logo-preview'); const logoPreview =
document.getElementById('logo-preview');

const logoImg = document.getElementById('logo-preview-img'); const logoImg =
document.getElementById('logo-preview-img');

logoImg.src = e.target.result; logoImg.src = e.target.result;

logoPreview.classList.remove('hidden'); logoPreview.classList.remove('hidden');

}; };

reader.readAsDataURL(file); reader.readAsDataURL(file);

} }

}); });



// Remove logo functionality // Remove logo functionality

document.getElementById('remove-logo').addEventListener('click', function () {
document.getElementById('remove-logo').addEventListener('click', function () {

document.getElementById('company-logo').value = ''; document.getElementById('company-logo').value = '';

document.getElementById('logo-preview').classList.add('hidden');
document.getElementById('logo-preview').classList.add('hidden');

document.getElementById('logo-preview-img').src = ''; document.getElementById('logo-preview-img').src = '';

}); });



// QR code upload handling // QR code upload handling

document.getElementById('upi-qr-code').addEventListener('change', function (e) {
document.getElementById('upi-qr-code').addEventListener('change', function (e) {

const file = e.target.files[0]; const file = e.target.files[0];

if (file) { if (file) {

const reader = new FileReader(); const reader = new FileReader();

reader.onload = function (e) { reader.onload = function (e) {

const qrPreview = document.getElementById('qr-preview'); const qrPreview = document.getElementById('qr-preview');

const qrImg = document.getElementById('qr-preview-img'); const qrImg = document.getElementById('qr-preview-img');

qrImg.src = e.target.result; qrImg.src = e.target.result;

qrPreview.classList.remove('hidden'); qrPreview.classList.remove('hidden');

}; };

reader.readAsDataURL(file); reader.readAsDataURL(file);

} }

}); });



// Remove QR code functionality // Remove QR code functionality

document.getElementById('remove-qr').addEventListener('click', function () {
document.getElementById('remove-qr').addEventListener('click', function () {

document.getElementById('upi-qr-code').value = ''; document.getElementById('upi-qr-code').value = '';

document.getElementById('qr-preview').classList.add('hidden');
document.getElementById('qr-preview').classList.add('hidden');

document.getElementById('qr-preview-img').src = ''; document.getElementById('qr-preview-img').src = '';

}); });

} }



// Profile management functions // Profile management functions

async function loadProfileData() { async function loadProfileData() {

if (!authManager.currentUser) return; if (!authManager.currentUser) return;



try { try {

const profile = await authManager.getUserProfile(authManager.currentUser.uid); const profile = await
authManager.getUserProfile(authManager.currentUser.uid);

if (profile) { if (profile) {

document.getElementById('display-name').value = profile.displayName || ''; document.getElementById('display-name').value
= profile.displayName || '';

document.getElementById('default-seller-name').value = profile.defaultSellerName || '';
document.getElementById('default-seller-name').value = profile.defaultSellerName || '';

document.getElementById('default-seller-address').value = profile.defaultSellerAddress || '';
document.getElementById('default-seller-address').value = profile.defaultSellerAddress || '';

document.getElementById('default-seller-gst').value = profile.defaultSellerGst || '';
document.getElementById('default-seller-gst').value = profile.defaultSellerGst || '';



// Load company logo if exists // Load company logo if exists

if (profile.companyLogo) { if (profile.companyLogo) {

const logoPreview = document.getElementById('logo-preview'); const logoPreview =
document.getElementById('logo-preview');

const logoImg = document.getElementById('logo-preview-img'); const logoImg =
document.getElementById('logo-preview-img');

logoImg.src = profile.companyLogo; logoImg.src = profile.companyLogo;

logoPreview.classList.remove('hidden'); logoPreview.classList.remove('hidden');

} }



// Load banking details // Load banking details

if (profile.banking) { if (profile.banking) {

document.getElementById('bank-name').value = profile.banking.bankName || ''; document.getElementById('bank-name').value
= profile.banking.bankName || '';

document.getElementById('account-holder').value = profile.banking.accountHolder || '';
document.getElementById('account-holder').value = profile.banking.accountHolder || '';

document.getElementById('account-number').value = profile.banking.accountNumber || '';
document.getElementById('account-number').value = profile.banking.accountNumber || '';

document.getElementById('ifsc-code').value = profile.banking.ifscCode || ''; document.getElementById('ifsc-code').value
= profile.banking.ifscCode || '';

document.getElementById('branch-name').value = profile.banking.branchName || '';
document.getElementById('branch-name').value = profile.banking.branchName || '';

document.getElementById('upi-id').value = profile.banking.upiId || ''; document.getElementById('upi-id').value =
profile.banking.upiId || '';

} }



// Load UPI QR code if exists // Load UPI QR code if exists

if (profile.upiQrCode) { if (profile.upiQrCode) {

const qrPreview = document.getElementById('qr-preview'); const qrPreview = document.getElementById('qr-preview');

const qrImg = document.getElementById('qr-preview-img'); const qrImg = document.getElementById('qr-preview-img');

qrImg.src = profile.upiQrCode; qrImg.src = profile.upiQrCode;

qrPreview.classList.remove('hidden'); qrPreview.classList.remove('hidden');

} }

} }

} catch (error) { } catch (error) {

console.error('Error loading profile:', error); console.error('Error loading profile:', error);

} }

} }



async function saveProfileData() { async function saveProfileData() {

if (!authManager.currentUser) return; if (!authManager.currentUser) return;



const profileData = { const profileData = {

displayName: document.getElementById('display-name').value, displayName: document.getElementById('display-name').value,

defaultSellerName: document.getElementById('default-seller-name').value, defaultSellerName:
document.getElementById('default-seller-name').value,

defaultSellerAddress: document.getElementById('default-seller-address').value, defaultSellerAddress:
document.getElementById('default-seller-address').value,

defaultSellerGst: document.getElementById('default-seller-gst').value, defaultSellerGst:
document.getElementById('default-seller-gst').value,

email: authManager.currentUser.email, email: authManager.currentUser.email,

updatedAt: new Date().toISOString() updatedAt: new Date().toISOString()

}; };



// Banking details // Banking details

const bankingData = { const bankingData = {

bankName: document.getElementById('bank-name').value, bankName: document.getElementById('bank-name').value,

accountHolder: document.getElementById('account-holder').value, accountHolder:
document.getElementById('account-holder').value,

accountNumber: document.getElementById('account-number').value, accountNumber:
document.getElementById('account-number').value,

ifscCode: document.getElementById('ifsc-code').value, ifscCode: document.getElementById('ifsc-code').value,

branchName: document.getElementById('branch-name').value, branchName: document.getElementById('branch-name').value,

upiId: document.getElementById('upi-id').value upiId: document.getElementById('upi-id').value

}; };



// Add banking details if any field is filled // Add banking details if any field is filled

if (Object.values(bankingData).some(value => value.trim() !== '')) { if (Object.values(bankingData).some(value =>
value.trim() !== '')) {

profileData.banking = bankingData; profileData.banking = bankingData;

} }



// Include company logo if uploaded // Include company logo if uploaded

const logoImg = document.getElementById('logo-preview-img'); const logoImg =
document.getElementById('logo-preview-img');

if (logoImg.src && !logoImg.src.includes('assets/images/')) { if (logoImg.src &&
!logoImg.src.includes('assets/images/')) {

profileData.companyLogo = logoImg.src; profileData.companyLogo = logoImg.src;

} }



// Include UPI QR code if uploaded // Include UPI QR code if uploaded

const qrImg = document.getElementById('qr-preview-img'); const qrImg = document.getElementById('qr-preview-img');

if (qrImg.src && qrImg.src.trim() !== '') { if (qrImg.src && qrImg.src.trim() !== '') {

profileData.upiQrCode = qrImg.src; profileData.upiQrCode = qrImg.src;

} }



try { try {

await authManager.createUserProfile(authManager.currentUser.uid, profileData); await
authManager.createUserProfile(authManager.currentUser.uid, profileData);

alert('Profile updated successfully!'); alert('Profile updated successfully!');

} catch (error) { } catch (error) {

console.error('Error saving profile:', error); console.error('Error saving profile:', error);

alert('Error saving profile: ' + error.message); alert('Error saving profile: ' + error.message);

} }

} }

</script>
</script>

</body>
</body>



</html>

</html>